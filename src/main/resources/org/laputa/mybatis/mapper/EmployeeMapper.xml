<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.laputa.mybatis.mapper.EmployeeMapper">

    <!-- Long addEmp(Employee emp); -->
    <insert id="addEmp" parameterType="org.laputa.mybatis.entity.Employee" useGeneratedKeys="true" keyProperty="id">
		insert into employee(title,email,gender)
		values(#{title},#{email},#{gender})
	</insert>

    <!-- List<Employee> getAllEmps(); -->
    <select id="getAllEmps" resultType="org.laputa.mybatis.entity.Employee">
		select * from employee
	</select>

    <!-- Employee getEmpById(Integer id); -->
    <select id="getEmpById" parameterType="int" resultType="org.laputa.mybatis.entity.Employee">
		select * from employee where id = #{id}
	</select>

    <!-- Long updateEmp(Employee emp); -->
    <update id="updateEmp">
		update employee
		set title=#{title}, email=#{email}, gender=#{gender}
		where id=#{id}
	</update>

    <!-- Long delEmpById(Integer id); -->
    <delete id="delEmpById">
		delete from employee where id=#{id}
	</delete>

    <!-- List<Employee> getEmpsLikeTitle(String title); -->
    <select id="getEmpsLikeTitle" resultType="org.laputa.mybatis.entity.Employee">
		select * from employee where title LIKE '%${title}%'
	</select>

    <!-- List<Employee> getEmpsOrderByIdDesc(); -->
    <select id="getEmpsOrderByIdDesc" resultType="org.laputa.mybatis.entity.Employee">
		select * from employee ORDER BY id DESC
	</select>

    <!-- List<Employee> getEmpsByPage(RowBounds bounds); -->
    <select id="getEmpsByPage" resultType="org.laputa.mybatis.entity.Employee">
		select * from employee where title like '%${title}%'
	</select>

    <!-- Map<String, Object> getEmpToMapById(Integer id); -->
    <select id="getEmpToMapById" resultType="map">
		select * from employee where id = #{id}
	</select>

    <!-- Map<String, Employee> getEmpToMapLikeTitle(String title); -->
    <select id="getEmpToMapLikeTitle" resultType="org.laputa.mybatis.entity.Employee">
		select * from employee where title like #{title}
	</select>

    <!-- Employee getEmpByMapping(Integer id); -->
    <resultMap id="empMap" type="org.laputa.mybatis.entity.Employee">
        <!-- 设置主键映射 -->
        <id column="id" property="id"/>
        <!-- 普通字段映射 -->
        <result column="title" property="title"/>
        <result column="email" property="email"/>
        <result column="gender" property="gender"/>
    </resultMap>
    <select id="getEmpByMapping" resultMap="empMap">
		select * from employee where id = #{id}
	</select>

    <!-- Employee getEmpByIdWithDep1(Integer id); -->
    <resultMap id="empCascadeDep1" type="org.laputa.mybatis.entity.Employee">
        <!-- 设置主键映射 -->
        <id column="id" property="id"/>
        <!-- 普通字段映射 -->
        <result column="title" property="title"/>
        <result column="email" property="email"/>
        <result column="gender" property="gender"/>
        <!-- 级联查询部门 -->
        <result column="dep_id" property="dep.id"/>
        <result column="dep_title" property="dep.title"/>
        <result column="dep_intro" property="dep.intro"/>
    </resultMap>
    <select id="getEmpByIdWithDep1" resultMap="empCascadeDep1">
		select *
		from employee e, department d
		where e.id = #{id}
		and e.dep_id = d.id
	</select>

    <!-- Employee getEmpByIdWithDep2(Integer id); -->
    <resultMap id="empCascadeDep2" type="org.laputa.mybatis.entity.Employee">
        <!-- 设置主键映射 -->
        <id column="id" property="id"/>
        <!-- 普通字段映射 -->
        <result column="title" property="title"/>
        <result column="email" property="email"/>
        <result column="gender" property="gender"/>
        <!-- 级联查询部门 -->
        <association property="dep">
            <!-- 设置主键映射 -->
            <id column="dep_id" property="id"/>
            <!-- 普通字段映射 -->
            <result column="dep_title" property="title"/>
            <result column="dep_intro" property="intro"/>
        </association>
    </resultMap>
    <select id="getEmpByIdWithDep2" resultMap="empCascadeDep2">
		select *
		from employee e, department d
		where e.id = #{id}
		and e.dep_id = d.id
	</select>

    <!-- Employee getEmpByIdWithDep3(Integer id); -->
    <resultMap id="empCascadeDep3" type="org.laputa.mybatis.entity.Employee">
        <!-- 设置主键映射 -->
        <id column="id" property="id"/>
        <!-- 普通字段映射 -->
        <result column="title" property="title"/>
        <result column="email" property="email"/>
        <result column="gender" property="gender"/>
        <!-- 级联查询部门 -->
        <association property="dep"
                     select="org.laputa.mybatis.mapper.DepartmentMapper.getDepById"
                     column="dep_id">
        </association>
    </resultMap>
    <select id="getEmpByIdWithDep3" resultMap="empCascadeDep3">
		select * from employee where id = #{id}
	</select>

    <!-- Employee getEmpByDepId(Integer depId); -->
    <select id="getEmpByDepId" resultType="org.laputa.mybatis.entity.Employee">
	    select * from employee where dep_id = #{depId}
    </select>

    <!-- Employee getDepWithGirl(Integer id); -->
    <resultMap id="depWithGirl" type="org.laputa.mybatis.entity.Employee">
        <!-- 设置主键映射 -->
        <id column="id" property="id"/>
        <!-- 普通字段映射 -->
        <result column="title" property="title"/>
        <result column="email" property="email"/>
        <result column="gender" property="gender"/>
        <!-- 级联查询员工 -->
        <discriminator column="gender" javaType="string">
            <case value="女" resultType="org.laputa.mybatis.entity.Employee">
                <association property="dep"
                             select="org.laputa.mybatis.mapper.DepartmentMapper.getDepById"
                             column="dep_id">
                </association>
            </case>
        </discriminator>
    </resultMap>
    <select id="getDepWithGirl" resultMap="depWithGirl">
	    select * from employee where id = #{id}
    </select>

    <!-- List<Employee> getEmpsByConditionIf(Employee emp); -->
    <select id="getEmpsByConditionIf" resultType="org.laputa.mybatis.entity.Employee">
        select * from employee
        <where>
            <if test="id!=null">
                and id = #{id}
            </if>
            <if test="title!=null">
                and title like #{title}
            </if>
            <if test="email!=null">
                and email like #{email}
            </if>
            <if test="gender!=null">
                and gender like #{gender}
            </if>
            <if test="dep!=null">
                and dep_id = #{dep.id}
            </if>
        </where>
    </select>

    <!-- boolean updateEmpByConditionIf(Employee emp); -->
    <update id="updateEmpByConditionIf">
        update employee
        <set>
            <if test="title!=null">
                title = #{title},
            </if>
            <if test="email!=null">
                email = #{email},
            </if>
            <if test="gender!=null">
                gender = #{gender},
            </if>
            <if test="dep!=null">
                dep_id = #{dep.id},
            </if>
        </set>
        where id = #{id}
    </update>


</mapper>
